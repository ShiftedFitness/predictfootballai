<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>PredictFootball.ai – Picks</title>
  <style>
    body {
      margin:0; padding:0; background:#111; color:#fff;
      font-family: Inter, system-ui, Arial; display:flex; justify-content:center;
    }
    #picks { width:100%; }
    .loading { max-width:750px; width:100%; margin:24px 12px; background:#30A278; color:#fff; border-radius:14px; padding:16px; }
  </style>
</head>
<body>
  <div id="picks"><div class="loading">Loading week…</div></div>

  <!-- Picks widget script (your existing picks-widget.js) -->
  <script src="/picks-widget.js"></script>
  <script>
    (async function init() {
      const qs = new URLSearchParams(location.search);
      const urlWeek = qs.get('week');
      const userId  = qs.get('userId') || ''; // optional—prefer to pass this from Adalo

      let weekToUse = urlWeek ? Number(urlWeek) : null;

      // If no week in URL, ask backend which week to show for PICKS
      if (!weekToUse) {
        try {
          const r = await fetch('/.netlify/functions/weeks', { cache:'no-store' });
          const j = await r.json();
          weekToUse = j.recommendedPickWeek || j.latest || 1;
        } catch (e) {
          console.warn('weeks lookup failed, defaulting to 1', e);
          weekToUse = 1;
        }
      }

      // Render the widget
      PredictFootballPicks.render(
        document.getElementById('picks'),
        { base: '/.netlify/functions', week: weekToUse, userId }
      );
    })();
  </script>
</body>
</html>
