<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover"/>
<title>TeleStats — Premier League Games &amp; Predictions</title>
<meta name="description" content="Test your Premier League knowledge with Bullseye, Starting XI, Who Am I?, Pop Quiz and more. Track your stats, climb the leaderboard."/>
<meta property="og:site_name" content="TeleStats"/>
<meta property="og:type" content="website"/>
<meta property="og:title" content="TeleStats — Premier League Games & Predictions"/>
<meta property="og:description" content="Retro-inspired football games powered by 30+ seasons of Premier League data. Play Bullseye, Starting XI, Who Am I? and more."/>
<meta property="og:image" content="https://res.cloudinary.com/dbfvogb95/image/upload/v1770835428/Screenshot_2026-02-11_at_19.43.16_m7urul.png"/>
<meta property="og:url" content="https://telestats.net/"/>
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:title" content="TeleStats — Premier League Games & Predictions"/>
<meta name="twitter:description" content="Retro-inspired football games powered by 30+ seasons of Premier League data."/>
<meta name="twitter:image" content="https://res.cloudinary.com/dbfvogb95/image/upload/v1770835428/Screenshot_2026-02-11_at_19.43.16_m7urul.png"/>
<link rel="stylesheet" href="telestats-theme.css"/>
<style>
* { box-sizing: border-box; margin: 0; padding: 0; }
body { min-height: 100vh; padding-bottom: 40px; }
.container { max-width: 640px; margin: 0 auto; padding: 0 16px; }

/* ── Logged-out hero ── */
.hero-out {
  text-align: center;
  padding: 48px 16px 36px;
}
.hero-out h1 { font-size: 36px; font-weight: 800; letter-spacing: -1px; margin-bottom: 8px; }
.hero-out h1 .accent { color: var(--accent-cyan); }
.hero-out .tagline {
  color: var(--text-secondary);
  font-size: 15px;
  line-height: 1.5;
  margin-bottom: 28px;
  max-width: 440px;
  margin-left: auto;
  margin-right: auto;
}

/* Big stat counters */
.hero-stats {
  display: flex;
  justify-content: center;
  gap: 28px;
  margin-bottom: 28px;
  flex-wrap: wrap;
}
.hero-stat {
  text-align: center;
}
.hero-stat-number {
  font-family: 'Space Mono', monospace;
  font-size: 36px;
  font-weight: 800;
  color: var(--accent-cyan);
  display: block;
  line-height: 1;
}
.hero-stat-label {
  font-size: 11px;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin-top: 4px;
}

.hero-cta {
  display: inline-block;
  background: var(--accent-yellow);
  color: #0B0F12;
  font-size: 16px;
  font-weight: 700;
  padding: 14px 32px;
  border-radius: 10px;
  text-decoration: none;
  transition: background 0.15s, transform 0.15s;
  margin-bottom: 12px;
}
.hero-cta:hover { background: #E6C009; transform: translateY(-1px); }
.hero-cta-secondary {
  display: inline-block;
  color: var(--accent-cyan);
  font-size: 13px;
  font-weight: 600;
  text-decoration: none;
  cursor: pointer;
  border: none;
  background: none;
  margin-left: 16px;
}
.hero-cta-secondary:hover { text-decoration: underline; }

/* ── Logged-in hero ── */
.hero-in {
  padding: 24px 0 8px;
}
.user-welcome {
  background: var(--bg-card);
  border-radius: 12px;
  padding: 16px 20px;
  margin-bottom: 20px;
  border: 1px solid rgba(255,255,255,0.04);
}
.user-welcome-top {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 10px;
}
.user-welcome-name { font-size: 16px; font-weight: 700; }
.user-welcome-streak {
  font-size: 13px;
  color: var(--accent-yellow);
  font-weight: 700;
  font-family: 'Space Mono', monospace;
}
.user-xp-row {
  display: flex;
  align-items: center;
  gap: 10px;
  font-size: 12px;
  color: var(--text-muted);
}
.user-xp-row .ts-xp-bar { flex: 1; }
.user-xp-label { white-space: nowrap; font-family: 'Space Mono', monospace; }

/* ── Featured Player (logged-in) ── */
.featured-player {
  background: var(--bg-card);
  border: 2px solid var(--accent-cyan);
  border-radius: 12px;
  padding: 20px;
  margin-bottom: 20px;
  font-family: 'Space Mono', monospace;
  position: relative;
  overflow: hidden;
}
.featured-player::before {
  content: '';
  position: absolute;
  inset: 0;
  background: repeating-linear-gradient(0deg, transparent, transparent 2px, rgba(0,229,255,0.03) 2px, rgba(0,229,255,0.03) 4px);
  pointer-events: none;
}
.fp-header {
  font-size: 10px;
  text-transform: uppercase;
  letter-spacing: 1.5px;
  color: var(--accent-cyan);
  margin-bottom: 8px;
}
.fp-name { font-size: 20px; font-weight: 800; margin-bottom: 2px; }
.fp-meta { font-size: 11px; color: var(--text-muted); margin-bottom: 12px; }
.fp-stats { display: flex; gap: 20px; margin-bottom: 12px; }
.fp-stat { text-align: center; }
.fp-val { font-size: 22px; font-weight: 800; color: var(--accent-yellow); display: block; }
.fp-lbl { font-size: 9px; color: var(--text-muted); text-transform: uppercase; }
.fp-clubs { font-size: 11px; color: var(--text-muted); }

/* ── Section headers ── */
.section-title {
  font-family: 'Space Mono', monospace;
  font-size: 12px;
  font-weight: 700;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 1px;
  margin-bottom: 12px;
  padding-left: 4px;
}

/* ── Game cards grid ── */
.games-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 10px;
  margin-bottom: 24px;
}
.game-card-mini {
  display: flex;
  flex-direction: column;
  background: var(--bg-card);
  border-radius: 12px;
  padding: 16px;
  text-decoration: none;
  color: var(--text-primary);
  border: 1px solid rgba(255,255,255,0.04);
  transition: all 0.15s;
}
.game-card-mini:hover {
  border-color: var(--accent-cyan);
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(0,0,0,0.3);
}
.game-card-mini .gc-icon { font-size: 28px; margin-bottom: 8px; }
.game-card-mini .gc-name { font-size: 14px; font-weight: 700; letter-spacing: -0.3px; margin-bottom: 4px; }
.game-card-mini .gc-desc { font-size: 11px; color: var(--text-muted); line-height: 1.4; }

/* ── Stat banner ── */
.stat-banner {
  background: linear-gradient(135deg, var(--bg-card), var(--bg-elevated));
  border-radius: 12px;
  padding: 16px 20px;
  margin-bottom: 24px;
  border: 1px solid rgba(255,255,255,0.04);
}
.stat-banner .stat-label {
  font-size: 11px;
  font-weight: 700;
  color: var(--accent-cyan);
  text-transform: uppercase;
  letter-spacing: 0.8px;
  margin-bottom: 6px;
  font-family: 'Space Mono', monospace;
}
.stat-banner .stat-text {
  font-size: 14px;
  color: var(--text-secondary);
  line-height: 1.5;
}
.stat-banner .stat-item { margin-bottom: 6px; }
.stat-banner .stat-item:last-child { margin-bottom: 0; }

/* ── Leaderboard widget ── */
.lb-widget {
  background: var(--bg-card);
  border-radius: 12px;
  padding: 16px;
  margin-bottom: 24px;
  border: 1px solid rgba(255,255,255,0.04);
}
.lb-row { display: flex; align-items: center; padding: 8px 0; gap: 10px; }
.lb-row + .lb-row { border-top: 1px solid rgba(255,255,255,0.04); }
.lb-rank { width: 24px; font-family: 'Space Mono', monospace; font-size: 14px; font-weight: 800; color: var(--text-muted); text-align: center; }
.lb-rank.gold { color: var(--accent-yellow); }
.lb-rank.silver { color: #C0C0C0; }
.lb-rank.bronze { color: #CD7F32; }
.lb-name { flex: 1; font-size: 14px; font-weight: 600; }
.lb-xp { font-family: 'Space Mono', monospace; font-size: 12px; color: var(--accent-yellow); font-weight: 700; }
.lb-empty { text-align: center; color: var(--text-muted); font-size: 13px; padding: 20px; }
.lb-footer { text-align: center; margin-top: 10px; }
.lb-footer a { color: var(--accent-cyan); font-size: 12px; font-weight: 600; text-decoration: none; }
.lb-footer a:hover { text-decoration: underline; }

/* ── Community spotlight ── */
.comm-grid { display: grid; gap: 10px; margin-bottom: 24px; }
.comm-card {
  display: flex; align-items: center; gap: 12px;
  background: var(--bg-card); border-radius: 10px; padding: 12px 14px;
  text-decoration: none; color: var(--text-primary);
  border: 1px solid rgba(255,255,255,0.04); transition: border-color 0.15s;
}
.comm-card:hover { border-color: var(--accent-cyan); }
.comm-icon { font-size: 24px; flex-shrink: 0; }
.comm-info { flex: 1; min-width: 0; }
.comm-title { font-size: 14px; font-weight: 600; }
.comm-meta { font-size: 11px; color: var(--text-muted); margin-top: 2px; }
.comm-plays { font-family: 'Space Mono', monospace; font-size: 11px; color: var(--text-muted); flex-shrink: 0; }

/* ── Community teaser (logged-out) ── */
.community-teaser {
  background: var(--bg-card);
  border-radius: 12px;
  padding: 20px;
  margin-bottom: 24px;
  border: 1px solid rgba(255,255,255,0.04);
  text-align: center;
}
.community-teaser h3 { font-size: 15px; font-weight: 700; margin-bottom: 6px; }
.community-teaser p { font-size: 13px; color: var(--text-muted); line-height: 1.5; }
.community-teaser a {
  display: inline-block; margin-top: 10px;
  color: var(--accent-cyan); font-size: 13px; font-weight: 600; text-decoration: none;
}
.community-teaser a:hover { text-decoration: underline; }

/* ── Footer ── */
footer {
  text-align: center;
  padding: 32px 16px 16px;
  font-size: 11px;
  color: var(--text-muted);
  opacity: 0.5;
  font-family: 'Space Mono', monospace;
}

@media (max-width: 400px) {
  .games-grid { grid-template-columns: 1fr; }
  .hero-out h1 { font-size: 28px; }
  .hero-stats { gap: 16px; }
  .hero-stat-number { font-size: 28px; }
}
</style>
</head>
<body>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="/js/ts-auth.js"></script>
<script src="/js/ts-data.js"></script>
<script src="/js/ts-nav.js"></script>

<div class="container">
  <!-- Content injected by JS based on auth state -->
  <div id="pageContent"></div>
</div>

<footer>
  TeleStats.net &middot; Built by <a href="https://shiftedlabs.io" target="_blank" rel="noopener" style="color:inherit;text-decoration:underline;">Shifted.Labs</a>
</footer>

<script>
const API_BASE = window.location.hostname === 'localhost' ? 'http://localhost:8888/.netlify/functions' : '/.netlify/functions';

function escHTML(s) {
  return String(s).replace(/[&<>"']/g, m =>
    ({ '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;' }[m]));
}

const GAMES_HTML = `
  <div class="section-title">Games</div>
  <div class="games-grid">
    <a href="/games/bullseye.html" class="game-card-mini">
      <span class="gc-icon">&#127919;</span>
      <div class="gc-name">Bullseye</div>
      <div class="gc-desc">Darts-style football 501</div>
    </a>
    <a href="/games/xi.html" class="game-card-mini">
      <span class="gc-icon">&#9917;</span>
      <div class="gc-name">Starting XI</div>
      <div class="gc-desc">Name the lineup</div>
    </a>
    <a href="/games/whoami.html" class="game-card-mini">
      <span class="gc-icon">&#128373;&#65039;</span>
      <div class="gc-name">Who Am I?</div>
      <div class="gc-desc">Guess the mystery player</div>
    </a>
    <a href="/games/quiz.html" class="game-card-mini">
      <span class="gc-icon">&#129504;</span>
      <div class="gc-name">Pop Quiz</div>
      <div class="gc-desc">5 data-powered questions</div>
    </a>
    <a href="/games/hol.html" class="game-card-mini">
      <span class="gc-icon">&#127183;</span>
      <div class="gc-name">Higher or Lower</div>
      <div class="gc-desc">Guess the stat</div>
    </a>
    <a href="/games/alpha.html" class="game-card-mini">
      <span class="gc-icon">&#128292;</span>
      <div class="gc-name">Player Alphabet</div>
      <div class="gc-desc">A-Z player names</div>
    </a>
  </div>`;

(async function() {
  await TSAuth.init();
  TSNav.render();

  const user = TSAuth.getUser();
  const isLoggedIn = user && !TSAuth.isAnonymous();
  const page = document.getElementById('pageContent');

  if (isLoggedIn) {
    renderLoggedIn(user, page);
  } else {
    renderLoggedOut(page);
  }
})();

/* ── LOGGED OUT HOMEPAGE ── */
function renderLoggedOut(page) {
  page.innerHTML = `
    <div class="hero-out">
      <h1>Tele<span class="accent">Stats</span></h1>
      <div class="tagline">Retro-inspired football games &mdash; from the birth of modern football in 1992 to today. Test your knowledge across 30+ seasons of global football data.</div>
      <div class="hero-stats">
        <div class="hero-stat">
          <span class="hero-stat-number">30+</span>
          <span class="hero-stat-label">Seasons</span>
        </div>
        <div class="hero-stat">
          <span class="hero-stat-number">36K+</span>
          <span class="hero-stat-label">Players</span>
        </div>
        <div class="hero-stat">
          <span class="hero-stat-number">6</span>
          <span class="hero-stat-label">Games</span>
        </div>
      </div>
      <div>
        <a href="/games/" class="hero-cta">Play Now</a>
        <button class="hero-cta-secondary" id="heroSignup">Create Free Account</button>
      </div>
    </div>

    ${GAMES_HTML}

    <div class="community-teaser">
      <h3>Build Your Own Games</h3>
      <p>Create custom football quizzes and share them with the community. Pick leagues, clubs, nationalities &mdash; the possibilities are endless.</p>
      <a href="/community/">Explore Community &rarr;</a>
    </div>`;

  document.getElementById('heroSignup')?.addEventListener('click', () => TSNav.showAuthModal('signup'));
}

/* ── LOGGED IN HOMEPAGE ── */
async function renderLoggedIn(user, page) {
  const xp = TSAuth.getXPProgress();
  const streak = user.current_streak || 0;

  page.innerHTML = `
    <div class="hero-in">
      <div class="user-welcome">
        <div class="user-welcome-top">
          <span class="user-welcome-name">${escHTML(user.username || user.display_name || 'Player')}</span>
          ${streak > 0 ? `<span class="user-welcome-streak">\uD83D\uDD25 ${streak} day streak</span>` : ''}
        </div>
        <div class="user-xp-row">
          <span class="user-xp-label">Lv.${xp.level} ${escHTML(xp.levelName)}</span>
          <div class="ts-xp-bar"><div class="ts-xp-bar-fill" style="width:${xp.pct}%"></div></div>
          <span class="user-xp-label">${xp.current.toLocaleString()} XP</span>
        </div>
      </div>
    </div>

    <!-- Featured Player -->
    <div id="featuredPlayer"></div>

    <!-- Did You Know — game-specific stats to get them hooked -->
    <div class="stat-banner" id="statBanner" style="display:none">
      <div class="stat-label">Did You Know?</div>
      <div class="stat-text" id="statText"></div>
    </div>

    <!-- Your Top Scores -->
    <div class="section-title">Your Top Scores</div>
    <div class="lb-widget" id="lbWidget">
      <div class="lb-empty">Loading...</div>
    </div>

    ${GAMES_HTML}

    <!-- Community -->
    <div class="section-title">Community</div>
    <div class="comm-grid" id="commGrid">
      <div class="lb-empty">Loading...</div>
    </div>`;

  // Load featured player
  loadFeaturedPlayer();
  // Load did-you-know stats
  loadDidYouKnow(user);
  // Load leaderboard
  loadLeaderboard();
  // Load community spotlight
  loadCommunity();
}

async function loadFeaturedPlayer() {
  try {
    const res = await fetch(API_BASE + '/featured-player');
    if (!res.ok) return;
    const fp = await res.json();
    const el = document.getElementById('featuredPlayer');
    if (!el || !fp.name) return;
    el.innerHTML = `
      <div class="featured-player">
        <div class="fp-header">Featured Player</div>
        <div class="fp-name">${escHTML(fp.name)}</div>
        <div class="fp-meta">${escHTML(fp.nationality)}${fp.position ? ' &middot; ' + escHTML(fp.position) : ''} &middot; ${fp.seasons} season${fp.seasons !== 1 ? 's' : ''}</div>
        <div class="fp-stats">
          <div class="fp-stat"><span class="fp-val">${fp.appearances}</span><span class="fp-lbl">Apps</span></div>
          <div class="fp-stat"><span class="fp-val">${fp.goals}</span><span class="fp-lbl">Goals</span></div>
          <div class="fp-stat"><span class="fp-val">${fp.assists || 0}</span><span class="fp-lbl">Assists</span></div>
        </div>
        <div class="fp-clubs">${fp.clubs.map(c => escHTML(c)).join(' &middot; ')}</div>
      </div>`;
  } catch (e) { /* silent */ }
}

async function loadDidYouKnow(user) {
  try {
    const userId = user?.id || null;
    const res = await fetch(API_BASE + '/did-you-know', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ userId })
    });
    if (!res.ok) return;
    const { stats } = await res.json();
    if (stats && stats.length > 0) {
      const banner = document.getElementById('statBanner');
      const text = document.getElementById('statText');
      if (banner && text) {
        text.innerHTML = stats.map(s => `<div class="stat-item">${escHTML(s.text)}</div>`).join('');
        banner.style.display = '';
      }
    }
  } catch (e) { /* silent */ }
}

async function loadLeaderboard() {
  const GAME_ICONS = { bullseye: '\u{1F3AF}', starting_xi: '\u26BD', who_am_i: '\u{1F575}\uFE0F', pop_quiz: '\u{1F9E0}', higher_lower: '\u{1F0CF}', player_alphabet: '\u{1F524}' };
  const GAME_NAMES = { bullseye: 'Bullseye', starting_xi: 'Starting XI', who_am_i: 'Who Am I?', pop_quiz: 'Pop Quiz', higher_lower: 'Higher or Lower', player_alphabet: 'Alphabet' };
  try {
    const widget = document.getElementById('lbWidget');
    if (!widget) return;
    // Try to get user's personal best scores per game type
    const user = TSAuth.getUser();
    if (!user?.id) {
      widget.innerHTML = '<div class="lb-empty">Play some games to see your top scores!</div>';
      return;
    }
    let scores = [];
    if (typeof TSData.getUserTopScores === 'function') {
      scores = await TSData.getUserTopScores(user.id);
    }
    if (!scores || scores.length === 0) {
      // Fallback: show global leaderboard
      const lb = await TSData.getGlobalLeaderboard(5);
      if (lb.length === 0) {
        widget.innerHTML = '<div class="lb-empty">Play some games to see your top scores here!</div>';
      } else {
        const rankClass = (i) => i === 0 ? 'gold' : i === 1 ? 'silver' : i === 2 ? 'bronze' : '';
        widget.innerHTML = '<div style="font-size:11px;color:var(--text-muted);text-transform:uppercase;letter-spacing:.5px;margin-bottom:8px;font-family:Space Mono,monospace;">Global Leaderboard</div>' +
          lb.map((p, i) => `
          <div class="lb-row">
            <span class="lb-rank ${rankClass(i)}">${i + 1}</span>
            <span class="lb-name">${escHTML(p.username || p.display_name || 'Player')}</span>
            <span class="lb-xp">${(p.total_xp || 0).toLocaleString()} XP</span>
          </div>`).join('') +
          '<div class="lb-footer"><a href="/leaderboard/">View Full Leaderboard &rarr;</a></div>';
      }
    } else {
      widget.innerHTML = scores.map(s => `
        <div class="lb-row">
          <span style="font-size:18px;width:28px;text-align:center;">${GAME_ICONS[s.game_type] || '\u{1F3AE}'}</span>
          <span class="lb-name">${escHTML(GAME_NAMES[s.game_type] || s.game_type)}</span>
          <span class="lb-xp">${s.best_score || 0}</span>
        </div>`).join('') +
        '<div class="lb-footer"><a href="/leaderboard/">View Full Leaderboard &rarr;</a></div>';
    }
  } catch (e) { console.warn('Leaderboard load failed:', e); }
}

async function loadCommunity() {
  try {
    const games = await TSData.getCommunityGames('all', 'popular', 3);
    const grid = document.getElementById('commGrid');
    if (!grid) return;
    if (games.length > 0) {
      grid.innerHTML = games.map(g => `
        <a href="/community/?game=${g.id}" class="comm-card">
          <span class="comm-icon">${TSData.GAME_TYPE_ICONS[g.game_type] || ''}</span>
          <div class="comm-info">
            <div class="comm-title">${escHTML(g.title)}</div>
            <div class="comm-meta">by ${escHTML(g.ts_users?.username || 'Unknown')} &middot; ${TSData.GAME_TYPE_LABELS[g.game_type] || g.game_type}</div>
          </div>
          <span class="comm-plays">${g.play_count || 0} plays</span>
        </a>`).join('') +
        '<div class="lb-footer"><a href="/community/">Browse All &rarr;</a></div>';
    } else {
      grid.innerHTML = '<div class="lb-empty">No community games yet. <a href="/community/" style="color:var(--accent-cyan)">Be the first to create one!</a></div>';
    }
  } catch (e) { console.warn('Community load failed:', e); }
}
</script>
</body>
</html>
