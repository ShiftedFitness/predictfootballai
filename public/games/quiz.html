<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover"/>
<title>TeleStats - Pop Quiz</title>
<meta name="description" content="5 data-powered questions from easy to hard. All generated from real Premier League data. How much do you really know?"/>
<meta property="og:site_name" content="TeleStats"/>
<meta property="og:type" content="website"/>
<meta property="og:title" content="Pop Quiz — TeleStats"/>
<meta property="og:description" content="5 data-powered questions from easy to hard. All generated from real Premier League data."/>
<meta property="og:image" content="https://res.cloudinary.com/dbfvogb95/image/upload/v1770835428/Screenshot_2026-02-11_at_19.43.16_m7urul.png"/>
<meta property="og:url" content="https://telestats.net/games/quiz.html"/>
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:title" content="Pop Quiz — TeleStats"/>
<meta name="twitter:description" content="5 data-powered questions from easy to hard. All from real Premier League data."/>
<meta name="twitter:image" content="https://res.cloudinary.com/dbfvogb95/image/upload/v1770835428/Screenshot_2026-02-11_at_19.43.16_m7urul.png"/>
<link rel="stylesheet" href="../telestats-theme.css"/>
<style>
* { box-sizing: border-box; margin: 0; padding: 0; }
body {
  background: var(--bg);
  color: var(--ink);
  min-height: 100vh;
  padding: 12px;
  line-height: 1.4;
}

.container { max-width: 480px; margin: 0 auto; }

.back-link {
  display: inline-block;
  color: var(--muted);
  text-decoration: none;
  font-size: 13px;
  margin-bottom: 8px;
}
.back-link:hover { color: var(--accent-cyan); }

.header {
  text-align: center;
  padding: 16px 0 8px;
}
.header h1 {
  font-size: 26px;
  font-weight: 800;
  letter-spacing: -0.5px;
}
.header h1 span { color: var(--accent-cyan); }
.header .subtitle {
  color: var(--muted);
  font-size: 13px;
  margin-top: 4px;
}

.card {
  background: var(--card);
  border-radius: 12px;
  padding: 20px;
  margin-bottom: 16px;
  box-shadow: 0 4px 16px rgba(0,0,0,0.25);
}
.card h2 { font-size: 17px; font-weight: 700; margin-bottom: 12px; letter-spacing: -0.5px; }

.option-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 8px;
  margin-bottom: 16px;
}
.option-btn {
  background: var(--card-dark);
  border: 2px solid transparent;
  border-radius: 10px;
  padding: 12px 10px;
  color: var(--ink);
  font-size: 13px;
  font-weight: 600;
  cursor: pointer;
  text-align: center;
  transition: all 0.15s;
}
.option-btn .color-dot {
  display: inline-block;
  width: 18px;
  height: 18px;
  border-radius: 4px;
  vertical-align: middle;
  margin-bottom: 4px;
  border: 1px solid rgba(255,255,255,0.2);
}
.option-btn .emoji { font-size: 20px; display: block; margin-bottom: 4px; }
.option-btn.wide { grid-column: 1 / -1; }

.go-btn {
  width: 100%;
  padding: 16px;
  border: none;
  border-radius: 10px;
  font-size: 16px;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.15s;
  letter-spacing: 0.3px;
}

.scope-badge {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  background: var(--card-dark);
  padding: 6px 14px;
  border-radius: 3px;
  font-size: 12px;
  font-weight: 600;
  margin-bottom: 12px;
  font-family: 'Space Mono', monospace;
  letter-spacing: 0.5px;
  text-transform: uppercase;
}
.scope-badge .dot {
  width: 8px;
  height: 8px;
  border-radius: 50%;
  background: var(--accent-cyan);
}

/* ====== QUIZ GAME ====== */
.progress-bar {
  display: flex;
  gap: 4px;
  margin-bottom: 16px;
}
.progress-pip {
  flex: 1;
  height: 6px;
  border-radius: 3px;
  background: var(--card-dark);
  transition: background 0.3s;
}
.progress-pip.correct { background: var(--accent-green); }
.progress-pip.wrong { background: var(--danger); }
.progress-pip.current { background: var(--accent-yellow); }

.q-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 16px;
}
.q-number {
  font-size: 12px;
  font-weight: 700;
  color: var(--muted);
  text-transform: uppercase;
  letter-spacing: 1px;
}
.q-difficulty {
  font-size: 11px;
  font-weight: 700;
  padding: 4px 12px;
  border-radius: 3px;
  text-transform: uppercase;
  letter-spacing: 1.2px;
  font-family: 'Space Mono', monospace;
}
.q-difficulty.easy { background: var(--accent-green); color: #0B0F12; }
.q-difficulty.medium { background: var(--accent-yellow); color: #0B0F12; }
.q-difficulty.hard { background: var(--accent-magenta); color: #fff; }

.q-text {
  font-size: 17px;
  font-weight: 700;
  margin-bottom: 20px;
  line-height: 1.4;
}

.answer-grid {
  display: grid;
  gap: 8px;
}
.answer-btn {
  width: 100%;
  padding: 14px 16px;
  background: var(--card-dark);
  border: 2px solid transparent;
  border-radius: 10px;
  color: var(--ink);
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  text-align: left;
  transition: all 0.15s;
}
.answer-btn:hover:not(.locked) { border-color: rgba(0,229,255,0.4); background: var(--btn); }
.answer-btn.selected { border-color: var(--accent-cyan); background: rgba(0,229,255,0.10); }
@keyframes correctPulse {
  0% { background: rgba(50,255,126,0.25); }
  50% { background: rgba(50,255,126,0.15); }
  100% { background: rgba(50,255,126,0.10); }
}
.answer-btn.correct { border-color: var(--accent-green); background: rgba(50,255,126,0.10); color: var(--accent-green); animation: correctPulse 0.5s ease-out; }
.answer-btn.wrong { border-color: var(--danger); background: rgba(224,85,85,0.15); color: var(--danger); }
.answer-btn.locked { cursor: default; pointer-events: none; }
.answer-btn .answer-letter {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 24px;
  height: 24px;
  border-radius: 6px;
  background: rgba(255,255,255,0.08);
  font-size: 12px;
  font-weight: 700;
  margin-right: 10px;
  flex-shrink: 0;
}

/* ====== RESULTS ====== */
.results-card {
  text-align: center;
  padding: 24px;
}
.results-score {
  font-size: 64px;
  font-weight: 800;
  color: var(--accent);
  margin-bottom: 4px;
  font-family: 'Space Mono', monospace;
  text-shadow: none;
}
.results-label {
  font-size: 15px;
  color: var(--muted);
  margin-bottom: 16px;
}
.results-breakdown {
  display: flex;
  justify-content: center;
  gap: 16px;
  margin-bottom: 16px;
}
.results-stat {
  text-align: center;
}
.results-stat .val {
  font-size: 22px;
  font-weight: 800;
  font-family: 'Space Mono', monospace;
}
.results-stat .val.green { color: var(--accent-green); }
.results-stat .val.red { color: var(--danger); }
.results-stat .lbl {
  font-size: 11px;
  color: var(--muted);
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.spinner {
  display: inline-block;
  width: 20px;
  height: 20px;
  border: 2px solid var(--muted);
  border-top-color: var(--accent);
  border-radius: 50%;
  animation: spin 0.6s linear infinite;
}
@keyframes spin { to { transform: rotate(360deg); } }

.hidden { display: none !important; }
</style>
</head>
<body>

<div class="ts-header">
  <img src="https://res.cloudinary.com/dbfvogb95/image/upload/v1770835428/Screenshot_2026-02-11_at_19.43.16_m7urul.png" alt="TeleStats" class="ts-logo"/>
  <span>EPL &middot; POP QUIZ</span>
  <span class="ts-time" id="tsTime"></span>
</div>

<div class="container">
  <a href="index.html" class="back-link">&larr; All Games</a>

  <div class="header">
    <h1>Pop <span>Quiz</span></h1>
    <div class="subtitle">10 questions. Easy to hard. All from real data.</div>
  </div>

  <div class="game-meta-links">
    <button class="game-meta-link" onclick="showRules()">&#9432; How to Play</button>
  </div>

  <!-- STEP 1: SETUP -->
  <div id="step1">
    <div class="card">
      <h2>Choose Scope</h2>
      <div class="option-grid" id="scopeGrid"></div>
    </div>
    <button class="go-btn primary" id="startBtn" disabled>Start Quiz</button>
  </div>

  <!-- STEP 2: QUIZ -->
  <div id="step2" class="hidden">
    <div class="scope-badge" id="gameBadge"></div>
    <div class="progress-bar" id="progressBar"></div>

    <div class="card" id="questionCard">
      <div class="q-header">
        <span class="q-number" id="qNumber">Question 1 of 5</span>
        <span class="q-difficulty" id="qDifficulty">Easy</span>
      </div>
      <div class="q-text" id="qText"></div>
      <div class="answer-grid" id="answerGrid"></div>
    </div>

    <button class="go-btn primary hidden" id="nextBtn">Next Question</button>
  </div>

  <!-- STEP 3: RESULTS -->
  <div id="step3" class="hidden">
    <div class="card">
      <div class="results-card">
        <div class="results-score" id="finalScore">0/5</div>
        <div class="results-label" id="finalLabel">Questions correct</div>
        <div class="results-breakdown">
          <div class="results-stat">
            <div class="val green" id="correctCount">0</div>
            <div class="lbl">Correct</div>
          </div>
          <div class="results-stat">
            <div class="val red" id="wrongCount">0</div>
            <div class="lbl">Wrong</div>
          </div>
        </div>
      </div>
    </div>
    <button class="go-btn primary" id="playAgainBtn">Play Again</button>
    <button class="go-btn secondary" id="backToMenuBtn">Back to Games</button>
  </div>
</div>

<!-- How to Play Modal -->
<div class="game-rules-overlay" id="rulesOverlay" onclick="if(event.target===this)closeRules()">
  <div class="game-rules-modal">
    <button class="game-rules-close" onclick="closeRules()">&times;</button>
    <h3>How to Play Pop Quiz</h3>
    <div class="rule-step"><div class="rule-num">1</div><div class="rule-text">Choose a <strong>team or league</strong> for your quiz.</div></div>
    <div class="rule-step"><div class="rule-num">2</div><div class="rule-text">Answer <strong>10 multiple-choice questions</strong> generated from real Premier League data.</div></div>
    <div class="rule-step"><div class="rule-num">3</div><div class="rule-text">Questions get <strong>harder as you go</strong> — from easy warm-ups to tricky deep cuts.</div></div>
    <div class="rule-step"><div class="rule-num">4</div><div class="rule-text">Each correct answer earns points. <strong>Harder questions</strong> are worth more.</div></div>
    <div class="rule-step"><div class="rule-num">5</div><div class="rule-text">See your final score and try to <strong>beat your personal best</strong>!</div></div>
  </div>
</div>
<script>
function showRules(){document.getElementById('rulesOverlay').classList.add('active');}
function closeRules(){document.getElementById('rulesOverlay').classList.remove('active');}
</script>

<footer style="text-align:center;padding:16px 16px 72px;font-size:11px;color:var(--muted);opacity:0.6;">
  TeleStats.net &middot; Built by <a href="https://shiftedlabs.io" target="_blank" rel="noopener" style="color:inherit;text-decoration:underline;">Shifted.Labs</a>
</footer>

<script>
const API_BASE = '/.netlify/functions';
const $ = id => document.getElementById(id);

const CLUB_COLOURS = {
  'club_arsenal': '#EF0107',
  'club_astonvilla': '#670E36',
  'club_blackburn': '#009EE0',
  'club_bolton': '#263C7F',
  'club_bournemouth': '#DA291C',
  'club_brentford': '#E30613',
  'club_brighton': '#0057B8',
  'club_burnley': '#6C1D45',
  'club_charlton': '#D4021D',
  'club_chelsea': '#034694',
  'club_coventry': '#27A9E1',
  'club_crystalpalace': '#1B458F',
  'club_derby': '#000000',
  'club_everton': '#003399',
  'club_fulham': '#000000',
  'club_ipswich': '#0033A0',
  'club_leeds': '#FFCD00',
  'club_leicester': '#003090',
  'club_liverpool': '#C8102E',
  'club_mancity': '#6CABDD',
  'club_manutd': '#DA291C',
  'club_middlesbrough': '#E11B22',
  'club_newcastle': '#241F20',
  'club_norwich': '#00A650',
  'club_nottmforest': '#DD0000',
  'club_portsmouth': '#001489',
  'club_qpr': '#1D5BA4',
  'club_reading': '#004494',
  'club_sheffutd': '#EE2737',
  'club_sheffwed': '#0066B3',
  'club_southampton': '#D71920',
  'club_stoke': '#E03A3E',
  'club_sunderland': '#EB172B',
  'club_swansea': '#000000',
  'club_tottenham': '#132257',
  'club_watford': '#FBEC5D',
  'club_westbrom': '#122F67',
  'club_westham': '#7A263A',
  'club_wigan': '#0033A0',
  'club_wimbledon': '#00008B',
  'club_wolves': '#FDB913',
};

const SCOPES = [
  { id: 'epl_alltime', label: 'Premier League (All-time)', type: 'league' },
  { id: 'club_arsenal',     label: 'Arsenal',        type: 'club' },
  { id: 'club_astonvilla',  label: 'Aston Villa',    type: 'club' },
  { id: 'club_blackburn',   label: 'Blackburn',      type: 'club' },
  { id: 'club_bolton',      label: 'Bolton',         type: 'club' },
  { id: 'club_bournemouth', label: 'Bournemouth',    type: 'club' },
  { id: 'club_brentford',   label: 'Brentford',      type: 'club' },
  { id: 'club_brighton',    label: 'Brighton',       type: 'club' },
  { id: 'club_burnley',     label: 'Burnley',        type: 'club' },
  { id: 'club_charlton',    label: 'Charlton',       type: 'club' },
  { id: 'club_chelsea',     label: 'Chelsea',        type: 'club' },
  { id: 'club_coventry',    label: 'Coventry',       type: 'club' },
  { id: 'club_crystalpalace', label: 'Crystal Palace', type: 'club' },
  { id: 'club_derby',       label: 'Derby',          type: 'club' },
  { id: 'club_everton',     label: 'Everton',        type: 'club' },
  { id: 'club_fulham',      label: 'Fulham',         type: 'club' },
  { id: 'club_ipswich',     label: 'Ipswich',        type: 'club' },
  { id: 'club_leeds',       label: 'Leeds',          type: 'club' },
  { id: 'club_leicester',   label: 'Leicester',      type: 'club' },
  { id: 'club_liverpool',   label: 'Liverpool',      type: 'club' },
  { id: 'club_mancity',     label: 'Man City',       type: 'club' },
  { id: 'club_manutd',      label: 'Man Utd',        type: 'club' },
  { id: 'club_middlesbrough', label: 'Middlesbrough', type: 'club' },
  { id: 'club_newcastle',   label: 'Newcastle',      type: 'club' },
  { id: 'club_norwich',     label: 'Norwich',        type: 'club' },
  { id: 'club_nottmforest', label: 'Nottm Forest',   type: 'club' },
  { id: 'club_portsmouth',  label: 'Portsmouth',     type: 'club' },
  { id: 'club_qpr',         label: 'QPR',            type: 'club' },
  { id: 'club_reading',     label: 'Reading',        type: 'club' },
  { id: 'club_sheffutd',    label: 'Sheff Utd',      type: 'club' },
  { id: 'club_sheffwed',    label: 'Sheff Wed',      type: 'club' },
  { id: 'club_southampton', label: 'Southampton',    type: 'club' },
  { id: 'club_stoke',       label: 'Stoke',          type: 'club' },
  { id: 'club_sunderland',  label: 'Sunderland',     type: 'club' },
  { id: 'club_swansea',     label: 'Swansea',        type: 'club' },
  { id: 'club_tottenham',   label: 'Spurs',          type: 'club' },
  { id: 'club_watford',     label: 'Watford',        type: 'club' },
  { id: 'club_westbrom',    label: 'West Brom',      type: 'club' },
  { id: 'club_westham',     label: 'West Ham',       type: 'club' },
  { id: 'club_wigan',       label: 'Wigan',          type: 'club' },
  { id: 'club_wimbledon',   label: 'Wimbledon',      type: 'club' },
  { id: 'club_wolves',      label: 'Wolves',         type: 'club' },
];

let selectedScope = null;
let quizData = null;
let currentQ = 0;
let score = 0;
let answers = []; // track per-question results

function init() {
  const grid = $('scopeGrid');
  for (const scope of SCOPES) {
    const btn = document.createElement('button');
    btn.className = 'option-btn' + (scope.type === 'league' ? ' wide' : '');
    const colour = CLUB_COLOURS[scope.id];
    if (scope.type === 'league') {
      btn.innerHTML = `<span class="emoji">&#127942;</span>${scope.label}`;
    } else {
      btn.innerHTML = `<span class="color-dot" style="background:${colour || '#555'}"></span> ${scope.label}`;
    }
    btn.onclick = () => {
      selectedScope = scope.id;
      grid.querySelectorAll('.option-btn').forEach(b => b.classList.remove('selected'));
      btn.classList.add('selected');
      $('startBtn').disabled = false;
    };
    grid.appendChild(btn);
  }

  $('startBtn').onclick = startQuiz;
  $('nextBtn').onclick = nextQuestion;
  $('playAgainBtn').onclick = resetToSetup;
  $('backToMenuBtn').onclick = () => { window.location.href = 'index.html'; };
}

async function startQuiz() {
  $('startBtn').disabled = true;
  $('startBtn').innerHTML = '<span class="spinner"></span> Generating quiz...';

  try {
    const res = await fetch(`${API_BASE}/quiz_start`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ action: 'generate_quiz', scopeId: selectedScope }),
    });
    quizData = await res.json();

    if (quizData.error) throw new Error(quizData.error);

    currentQ = 0;
    score = 0;
    answers = [];

    const scopeLabel = SCOPES.find(s => s.id === selectedScope)?.label || '';
    $('gameBadge').innerHTML = `<span class="dot"></span> ${scopeLabel}`;

    // Build progress pips
    const bar = $('progressBar');
    bar.innerHTML = '';
    for (let i = 0; i < quizData.questions.length; i++) {
      const pip = document.createElement('div');
      pip.className = 'progress-pip';
      pip.id = `pip${i}`;
      bar.appendChild(pip);
    }

    $('step1').classList.add('hidden');
    $('step2').classList.remove('hidden');
    $('step3').classList.add('hidden');

    // Scroll to top so quiz is visible
    window.scrollTo({ top: 0, behavior: 'smooth' });

    showQuestion();

  } catch (err) {
    alert('Failed to generate quiz: ' + err.message);
  }

  $('startBtn').disabled = false;
  $('startBtn').textContent = 'Start Quiz';
}

function showQuestion() {
  const q = quizData.questions[currentQ];
  if (!q) {
    showResults();
    return;
  }

  $('qNumber').textContent = `Question ${currentQ + 1} of ${quizData.questions.length}`;

  const diff = q.difficulty || 'easy';
  $('qDifficulty').textContent = diff.charAt(0).toUpperCase() + diff.slice(1);
  $('qDifficulty').className = `q-difficulty ${diff}`;

  $('qText').textContent = q.q;

  // Update progress
  $(`pip${currentQ}`).classList.add('current');

  // Render answers
  const grid = $('answerGrid');
  const letters = ['A', 'B', 'C', 'D'];
  grid.innerHTML = q.options.map((opt, i) => `
    <button class="answer-btn" data-idx="${i}">
      <span class="answer-letter">${letters[i]}</span>
      ${escHtml(String(opt))}
    </button>
  `).join('');

  grid.querySelectorAll('.answer-btn').forEach(btn => {
    btn.onclick = () => handleAnswer(parseInt(btn.dataset.idx));
  });

  $('nextBtn').classList.add('hidden');
}

function handleAnswer(selected) {
  const q = quizData.questions[currentQ];
  const correct = q.answer;
  const isCorrect = selected === correct;

  if (isCorrect) score++;
  answers.push({ qIdx: currentQ, selected, correct, isCorrect });

  // Lock all buttons and show result
  const btns = $('answerGrid').querySelectorAll('.answer-btn');
  btns.forEach((btn, i) => {
    btn.classList.add('locked');
    if (i === correct) btn.classList.add('correct');
    else if (i === selected && !isCorrect) btn.classList.add('wrong');
  });

  // Update progress pip
  const pip = $(`pip${currentQ}`);
  pip.classList.remove('current');
  pip.classList.add(isCorrect ? 'correct' : 'wrong');

  // Show next button or results
  if (currentQ < quizData.questions.length - 1) {
    $('nextBtn').classList.remove('hidden');
  } else {
    setTimeout(showResults, 1200);
  }
}

function nextQuestion() {
  currentQ++;
  showQuestion();
}

function showResults() {
  $('step2').classList.add('hidden');
  $('step3').classList.remove('hidden');

  const total = quizData.questions.length;
  $('finalScore').textContent = `${score}/${total}`;
  $('correctCount').textContent = score;
  $('wrongCount').textContent = total - score;

  if (score === total) {
    $('finalLabel').textContent = 'Perfect score!';
    $('finalScore').style.color = 'var(--gold)';
  } else if (score >= 3) {
    $('finalLabel').textContent = 'Great job!';
    $('finalScore').style.color = 'var(--accent)';
  } else {
    $('finalLabel').textContent = 'Better luck next time';
    $('finalScore').style.color = 'var(--danger)';
  }
}

function resetToSetup() {
  $('step2').classList.add('hidden');
  $('step3').classList.add('hidden');
  $('step1').classList.remove('hidden');
  quizData = null;
  currentQ = 0;
  score = 0;
  answers = [];
}

function escHtml(str) {
  const div = document.createElement('div');
  div.textContent = str;
  return div.innerHTML;
}

init();
</script>

<script>
function updateClock() {
  const now = new Date();
  const hh = String(now.getHours()).padStart(2, '0');
  const mm = String(now.getMinutes()).padStart(2, '0');
  const el = document.getElementById('tsTime');
  if (el) el.textContent = hh + ':' + mm;
}
updateClock();
setInterval(updateClock, 30000);
</script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="/js/ts-auth.js"></script>
<script src="/js/ts-data.js"></script>
<script src="/js/ts-nav.js"></script>
<script>
(async function tsIntegrate() {
  await TSAuth.init();
  TSNav.render();

  // Hook showResults to log session
  const _origShowResults = window.showResults;
  window.showResults = function () {
    _origShowResults();
    tsLogQuizSession();
  };

  async function tsLogQuizSession() {
    try {
      const total = quizData ? quizData.questions.length : 5;
      const scopeLabel = selectedScope || '';
      const result = await TSData.logGameSession({
        game_type: 'pop_quiz',
        game_category: scopeLabel,
        score: score,
        max_possible_score: total,
        correct_answers: score,
        total_questions: total,
        is_perfect_round: score === total,
        completed: true
      });
      if (result && !result.error) {
        TSNav.showXPToast(result);
        TSNav.showShareCard({
          game_type: 'pop_quiz',
          game_category: scopeLabel,
          correct_answers: score,
          total_questions: total,
          is_perfect_round: score === total,
          xp_earned: result.xp_earned
        });
      }
    } catch (e) { console.warn('[TS] session log failed:', e); }
  }
})();
</script>
</body>
</html>
